{% extends "atcore/resource_workflows/workflow_results_view.html" %}
{% load tethys_gizmos static %}

{% block app_content_wrapper_override %}
  {{ block.super }}
  <input type="button" value="Print Report" id="btnPrint" class="btn btn-info" style="position:absolute;right:20px;top:70px;"/>
  <script type="text/javascript">
    $("#btnPrint").on("click", function() {
      let curURL = window.location.href;
      history.replaceState(history.state, '', '/steem-report');
      window.print();
      history.replaceState(history.state, '', curURL);
    });
  </script>
{% endblock %}

{% block content_dependent_styles %}
  {{ block.super }}
  {% if has_tabular_data %}
    <style>
      .map-form {
        width: 500px;
        height: 500px;
        padding-left: 25px;
        padding-top: 25px;
      }
      .tab-data {
        display: block;
      }
    </style>
  {% endif %}
  <style>
    .modebar{
      display: none !important;
    }
    input {
      margin-bottom: 40px;
      margin-top: 10px;
    }
    h3 {
      padding-top: 20px !important;
    }
    [contentEditable=true]:empty:not(:focus)::before{
        content:attr(data-ph)
    }
    .textareaclone {
      margin-top: 10px;
      margin-bottom: 40px;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid gray;
    }

    @media print {
      input:placeholder-shown {
          display: none;
      }
      div:empty {
          display: none;
      }
      div {
        border-style: none !important;
      }
      body {
        transform: scale(1);
      }
      @page {
        margin-top: 0
        padding-top: 72px !important;
      }
      div[id*="resultType-"] {
        page-break-after: always;
      }
      #inner-app-content {
        overflow: visible;
      }
      #app-content {
        overflow: visible;
      }
      #btnPrint, #app-header, #app-actions,  #app-actions > *, .results-tabs {
        display: none;
      }
      #app-content-wrapper.show-nav #app-content {
        padding-right: 0;
        transform: translate3d(0,0,0);
        overflow: true;
      }
      #app-navigation {
        display: none;
      }
      #app-content-wrapper #app-content {
        padding-top: 0;
        overflow: visible;
      }
      #app-content-wrapper {
        overflow-x: visible;
      }
      a[href]:after {
        content: none !important;
      }
    }
  </style>
{% endblock %}

{% block import_gizmos %}
  {{ block.super }}
  {% import_gizmo_dependency plotly_view %}
  {% import_gizmo_dependency datatable_view %}
  {% import_gizmo_dependency map_view %}
{% endblock %}

{% block app_content %}
  {{ block.super }}

  <form id="report_form">
  <div id="report_workflow_data">
    {% if has_tabular_data %}
      <div class="tab-data">
        {% for tab_data_title, tab_data in tabular_data.items %}
        <h2>{{ tab_data_title }}</h2>
        {% for k, v in tab_data.items %}
        <p><b>{{ k|title }}:</b> {{ v }}</p>
        {% endfor %}
        {% endfor %}
      </div>
    {% endif %}
    <!-- Try to find a way to move the script (one line below) into the component. -->
    <script>let maps = [] </script>
    {% for result in report_results %}
      {% for k, v in result.items %}
        {% if k == 'map' %}
          <div id="resultType-map-{{ forloop.counter }}">
            <h3 style="padding-top:72px;">{{ v.1.legend_title }}</h3>
            {% if v.0 %}
              <h4>Description: {{ v.0 }}</h4>
            {% endif %}
            {% set map_layer = v.1 %}
            {% include "./components/report_workflow_map_component.html" %}
            <div contentEditable=true class="textareaclone" data-ph="Map Note"></div>
          </div>
        {% elif k == 'dataset' %}
          <div id="resultType-table-{{ forloop.counter }}">
            <h3  style="padding-top:72px;">{{ v.title }}</h3>
            {% if v.data_description %}
              <h4>Description: {{ v.data_description }}</h4>
            {% endif %}
            <div>
              {% gizmo v.data_table %}
            </div>
            <div contentEditable=true class="textareaclone" data-ph="Data Note"></div>
          </div>
        {% elif k == 'plot' %}
          <div id="resultType-plot-{{ forloop.counter }}">
            <h3  style="padding-top:72px;">{{ v.0 }}</h3>
            {% if v.1 %}
              <h4>Description: {{ v.1 }}</h4>
            {% endif %}
            <div id="resultPlotDiv{{ forloop.counter }}" style="width:950px;">
              {% gizmo v.2 %}
            </div>
            <div contentEditable=true class="textareaclone" data-ph="Plot Note"></div>
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>
  </form>
{% endblock %}

{% block scripts %}
  {{ block.super }}
{% endblock %}



{% block after_app_content %}
  {{ block.super }}
{% endblock %}