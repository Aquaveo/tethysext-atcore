{% extends "atcore/resource_workflows/workflow_results_view.html" %}
{% load tethys_gizmos static %}

{% block content_dependent_styles %}
  {{ block.super }}
  {% if has_tabular_data %}
    <style>
      .map-form {
        width: 500px;
        height: 500px;
        padding-left: 25px;
        padding-top: 25px;
      }
      .tab-data {
        padding-left: 25px;
        padding-top: 25px;
        display: block;
      }
    </style>
  {% endif %}
  <style>
    .modebar{
      display: none !important;
     }
  </style>
{% endblock %}

{% block import_gizmos %}
  {{ block.super }}
  {% import_gizmo_dependency plotly_view %}
  {% import_gizmo_dependency datatable_view %}
  {% import_gizmo_dependency map_view %}
{% endblock %}

{% block app_content %}
  {{ block.super }}

  <form id="report_form">
  <input type="button" value="Export to PDF" id="btnPrint" />
  <script type="text/javascript">
    $("#btnPrint").on("click", function() {
      let divContents=$('#report_workflow_data').html()
      let appNavigation =
      let printWindow = window.open('');
      printWindow.document.write('<html><head><title>DIV Contents</title>');
      printWindow.document.write('</head><body >');
      printWindow.document.write(divContents);
      printWindow.document.write('</body></html>');
      printWindow.print();
      printWindow.close();
<!--      let doc = new jsPDF('landscape');-->
<!--      doc.fromHTML($('#report_workflow_data')[0], 15, 15, {-->
<!--        width: 170-->
<!--      }, function() {-->
<!--        doc.save('sample-file.pdf');-->
<!--      });-->
    });
  </script>
  <div id="report_workflow_data">
    {% if has_tabular_data %}
      <div class="tab-data">
        {% for tab_data_title, tab_data in tabular_data.items %}
        <h2>{{ tab_data_title }}</h2>
        {% for k, v in tab_data.items %}
        <p><b>{{ k|title }}:</b> {{ v }}</p>
        {% endfor %}
        {% endfor %}
      </div>
    {% endif %}
    <!-- Try to find a way to move the script (one line below) into the component. -->
    <script>let maps = [] </script>
    {% for result in report_results %}
      {% for k, v in result.items %}
        {% if k == 'map' %}
          <h3>{{ v.legend_title }}</h3>
          {% set map_layer = v %}
          {% include "./components/report_workflow_map_component.html" %}
        {% elif k == 'dataset' %}
          <h3>{{ v.title }}</h3>
          <div>
            {% gizmo v.data_table %}
          </div>
        {% elif k == 'plot' %}
          <h3>{{ v.0 }}</h3>
          <div>
            {% gizmo v.1 %}
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>
  </form>
{% endblock %}

{% block scripts %}
  {{ block.super }}
{% endblock %}



{% block after_app_content %}
  {{ block.super }}
{% endblock %}