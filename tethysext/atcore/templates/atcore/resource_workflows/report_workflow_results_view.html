{% extends "atcore/resource_workflows/workflow_results_view.html" %}
{% load tethys_gizmos static %}

{% block app_content_wrapper_override %}
  {{ block.super }}
  <input type="button" value="Print Report" id="btnPrint" class="btn btn-info" style="position:absolute;right:20px;top:70px;"/>
  <script type="text/javascript">
    $("#btnPrint").on("click", function() {
      let curURL = window.location.href;
      history.replaceState(history.state, '', '/steem-report');
      window.print();
      history.replaceState(history.state, '', curURL);
    });
  </script>
{% endblock %}

{% block content_dependent_styles %}
  {{ block.super }}
  {% if has_tabular_data %}
    <style>
      .map-form {
        width: 500px;
        height: 500px;
        padding-left: 25px;
        padding-top: 25px;
      }
      .tab-data {
        display: block;
      }
    </style>
  {% endif %}
  <style>
    h4 {
      font-size: 20px;
    }
    .map-view-result {
      width:100%; height:600px;
    }
    .legend-list {
        list-style: none;
        padding-inline-start: 5px;
        transition: height 0.2s ease-out;
        margin-left: 10px;
        margin-right: auto;
    }

    .legend-list-item {
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .legend-list-item .flatmark {
        display: inline-block;
        max-width: 310px;
        overflow: hidden;
    }

    .legend-item {
        position: relative;
    }

    .legend-item p {
        padding-left: 60px;
        padding-top: 2px;
    }

    .legend-item .color-box {
        width: 40px;
        height: 10px;
        display: inline-block;
        position: absolute;
        left: 5px;
        top: 5px;
    }
    .modebar{
      display: none !important;
    }
    [contentEditable=true]:empty:not(:focus)::before{
        content:attr(data-ph)
    }
    .add-border {
      margin-top: 10px;
      margin-bottom: 40px;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid gray;
    }

    @media print {
      .map-view-result {
        width:700px; height:600px;
      }
      div:empty {
          display: none;
      }
      div {
        border-style: none !important;
      }
      body {
        color-adjust: exact;
        -webkit-print-color-adjust: exact;
        transform: scale(1);
        padding-top: 60px;
      }
      @page {
        margin-top: 0;
      }
      div[id*="resultType-"] {
        padding-top: 60px;
        page-break-inside: avoid;
      }
      .add-border {
        margin-top: 0;
        margin-bottom: 0;
      }
      #inner-app-content {
        overflow: visible;
      }
      #app-content {
        overflow: visible;
      }
      #btnPrint, #app-header, #app-actions,  #app-actions > *, .results-tabs {
        display: none;
      }
      #app-content-wrapper.show-nav #app-content {
        padding-right: 0;
        transform: translate3d(0,0,0);
        overflow: true;
      }
      #app-navigation {
        display: none;
      }
      #app-content-wrapper #app-content {
        padding-top: 0;
        overflow: visible;
      }
      #app-content-wrapper {
        overflow-x: visible;
      }
      a[href]:after {
        content: none !important;
      }
    }
  </style>
{% endblock %}

{% block import_gizmos %}
  {{ block.super }}
  {% import_gizmo_dependency plotly_view %}
  {% import_gizmo_dependency bokeh_view %}
  {% import_gizmo_dependency datatable_view %}
  {% import_gizmo_dependency map_view %}
{% endblock %}

{% block app_content %}
  {{ block.super }}

  <form id="report_form">
  <div id="report_workflow_data">
    {% if has_tabular_data %}
      <div class="tab-data">
        {% for tab_data_title, tab_data in tabular_data.items %}
        <h2>{{ tab_data_title }}</h2>
        {% for k, v in tab_data.items %}
        <p><b>{{ k|title }}:</b> {{ v }}</p>
        {% endfor %}
        {% endfor %}
      </div>
    {% endif %}
    <div contentEditable=true class="add-border" data-ph="General Note"></div>
    <!-- Try to find a way to move the script (one line below) into the component. -->
    <script>let maps = [] </script>
    {% for result in report_results %}
      {% for k, v in result.items %}
        {% if k == 'map' %}
          <div id="resultType-map-{{ forloop.counter }}">
          <h3>{{ v.0 }}</h3>
          {% if v.1 %}
            <h4>Description: {{ v.1 }}</h4>
          {% endif %}
          <div class="container-fluid">
            <div class="row">
            {% set map_layer = v.3 %}
            {% set legend = v.2 %}
            {% include "./components/report_workflow_map_component.html" %}
            </div>
          </div>
          <div contentEditable=true class="add-border" data-ph="Map Note"></div>
          </div>
        {% elif k == 'dataset' %}
          <div id="resultType-table-{{ forloop.counter }}">
            <h3>{{ v.title }}</h3>
            {% if v.data_description %}
              <h4>Description: {{ v.data_description }}</h4>
            {% endif %}
            <div>
              {% gizmo v.data_table %}
            </div>
            <div contentEditable=true class="add-border" data-ph="Data Note"></div>
          </div>
        {% elif k == 'plot' %}
          <div id="resultType-plot-{{ forloop.counter }}">
            <h3>{{ v.0 }}</h3>
            {% if v.1 %}
              <h4>Description: {{ v.1 }}</h4>
            {% endif %}
            <div class="container-fluid">
              <div class="row">
                <div class="col-xs-12" id="resultPlotDiv{{ forloop.counter }}">
                  {% gizmo v.2 %}
                </div>
                </div>
              </div>
            </div>
            <div contentEditable=true class="add-border" data-ph="Plot Note"></div>
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>
  </form>
{% endblock %}

{% block scripts %}
  {{ block.super }}
{% endblock %}



{% block after_app_content %}
  {{ block.super }}
{% endblock %}