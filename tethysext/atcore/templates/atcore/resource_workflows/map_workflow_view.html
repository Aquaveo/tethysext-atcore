{% extends "atcore/map_view/map_view.html" %}
{% load tethys_gizmos staticfiles %}

{# OVERRIDE DEFAULT ACTIVE TAB #}
{% block disable_default_tab %}{% endblock %}
{% block disable_default_tab_panel %}{% endblock %}

{% block custom_map_tabs %}
  {# WORKFLOW TAB #}
  <li role="presentation" class="active">
    <a id="workflow-tab-toggle"
       href="#workflow-tab-panel"
       aria-controls="workflow-tab-panel"
       role="tab"
       data-toggle="tab">Workflow</a>
  </li>
{% endblock %}

{% block custom_map_tab_panels %}
  {# WORKFLOW TAB PANEL #}
  <div role="tabpanel" class="tab-pane active" id="workflow-tab-panel">
    <ul class="workflow-steps">
      {% for step in steps %}
      <li>
        <a class="workflow-step {% if step.id == current_step.id %}active {% endif %}workflow-step-{{ step.status }}"
           title="{{ step.help }}"
           {% if step.link %}href="{% url url_map_name resource.id workflow.id step.id %}"{% endif %}>
          {% if step.status == 'pending' %}
          <i class="far fa-circle"></i>
          {% elif step.status == 'complete' %}
          <i class="fas fa-check-circle"></i>
          {% elif step.status == 'error' or step.status == 'failed' %}
          <i class="fas fa-times-circle"></i>
          {% elif step.status == 'working' %}
          <i class="fas fa-cogs"></i>
          {% else %}
          <i class="fas fa-question-circle"></i>
          {% endif %}
          <span class="workflow-step-title">{{ step.name }}</span>
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}

{% block map %}
  <form id="map-workflow-form" class="map-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input name="method" value="save-step-data" hidden>
    {{ block.super }}
  </form>
{% endblock %}

{% block app_actions %}
  {% if previous_step %}
  <button class="btn btn-default btn-previous" name="previous-submit" type='submit' form="map-workflow-form">Previous</button>
  {% endif %}

  {% if next_step %}
  <button class="btn btn-default btn-next" name="next-submit" type='submit' form="map-workflow-form">Next</button>
  {% else %}
  <button class="btn btn-default btn-next" name="next-submit" type='submit' form="map-workflow-form">Submit</button>
  {% endif %}

  {{ block.super }}
{% endblock %}

{% block content_dependent_styles %}
  {{ block.super }}
  <link href="{% static 'atcore/resource_workflows/atcore_map_workflow.css' %}" rel="stylesheet"/>
{% endblock %}