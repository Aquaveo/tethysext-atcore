{% for layer_group in layer_groups %}
  <li class="layer-group-item {{ layer_group.id }}">
    {# LAYER GROUP VISIBILITY CONTROL #}
    <label class="flatmark"><span class="display-name">{{ layer_group.display_name }}</span>
      <input type="checkbox"
             class="layer-group-visibility-control"
             {% if layer_group.visible %}checked="checked"{% endif %}
             data-layer-group-id="{{ layer_group.id }}">
      <span class="checkmark checkbox"></span>
    </label>

    {# LAYER GROUP CONTEXT MENU #}
    {% if show_public_toggle or show_remove or show_rename %}
      <div class="dropdown layers-context-menu pull-right">
        <a id="{{ layer_group.id }}--context-menu"
           class="btn btn-xs dropdown-toggle layers-btn"
           data-toggle="dropdown" aria-haspopup="true"
           aria-expanded="true">
          <span class="glyphicon glyphicon-option-vertical"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-right" aria-labeledby="{{ layer_group.id }}--context-menu">
          {% if show_rename %}
            <li><a class="rename-action" href="javascript:void(0);"><span class="glyphicon glyphicon-pencil"></span><span class="command-name">Rename</span></a></li>
          {% endif %}
          {% if show_remove %}
          <li><a class="remove-action" href="javascript:void(0);" data-remove-type="layer" data-layer-id="{{ layer.data.layer_name }}"><span class="glyphicon glyphicon-remove"></span><span class="command-name">Remove</span></a></li>
          {% endif %}
          {% if layer_group.id == 'custom_layers' %}
            <li role="separator" class="divider"></li>
            <li><a class="add-layer-to-layer-group" href="javascript:void(0);"><span class="glyphicon glyphicon-plus"></span><span class="command-name">Add Layer</span></a></li>
          {% endif %}
        </ul>
      </div>
    {% endif %}
    <a id="{{ layer_group.id }}--collapse"
       class="collapse-action btn btn-xs layers-btn pull-right"
       data-collapsed="false">
      <span class="glyphicon glyphicon-chevron-down"></span>
    </a>
  </li>

  <ul class="layer-list" data-collapsed="false">
    {% for layer in layer_group.layers %}
    <li class="layer-list-item">
      {# LAYER VISIBILITY CONTROL #}
      <label class="flatmark"><span class="display-name">{{ layer.legend_title }}</span>
        <input type="{{ layer_group.control }}"
               class="layer-visibility-control"
               {% if layer.layer_options.visible %}checked="checked"{% endif %}
               {% if not layer_group.visible %}disabled{% endif %}
               data-layer-id="{{ layer.data.layer_id }}"
               data-layer-variable="{{ layer.data.layer_variable }}"
               name="{{ layer_group.id }}">
        <span class="checkmark {{ layer_group.control }}"></span>
      </label>

      {# LAYER CONTEXT MENU #}
      <div class="dropdown layers-context-menu pull-right">
        <a id="{{ layer.data.layer_id }}--context-menu"
           class="btn btn-xs dropdown-toggle layers-btn {% if not layer_group.visible %}disabled{% endif %}"
           data-toggle="dropdown"
           aria-haspopup="true"
           aria-expanded="true">
          <span class="glyphicon glyphicon-option-vertical"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-right" aria-labeledby="{{ layer.data.layer_id }}--context-menu">
          {% if show_rename %}
            <li><a class="rename-action" href="javascript:void(0);"><span class="glyphicon glyphicon-pencil"></span><span class="command-name">Rename</span></a></li>
          {% endif %}
          {% if show_remove %}
          <li><a class="remove-action" href="javascript:void(0);" data-remove-type="layer" data-layer-id="{{ layer.data.layer_id }}"><span class="glyphicon glyphicon-remove"></span><span class="command-name">Remove</span></a></li>
          {% endif %}
          {% if show_public_toggle or show_remove or show_rename %}
            <li role="separator" class="divider"></li>
          {% endif %}
          <li><a class="zoom-to-layer-action" href="javascript:void(0);" data-layer-id="{{ layer.data.layer_id }}"><span class="glyphicon glyphicon-fullscreen"></span><span class="command-name">Zoom to Layer</span></a></li>
          {% comment %}
          {# TODO: Implement download layer action #}
          <li role="separator" class="divider"></li>
          <li><a class="download-layer" href="javascript:void(0);"><span class="glyphicon glyphicon-cloud-download"></span><span class="command-name">Download</span></a></li>
          {% endcomment %}
          <li role="separator" class="divider"></li>
          <li>
            <div class="flat-slider-container">
              <label><span class="glyphicon glyphicon-adjust"></span><span class="command-name">Opacity: </span><span class="slider-value">100%</span></label>
              <input type="range"
                     class="flat-slider layer-opacity-control"
                     min="0" max="100"
                     value="100"
                     data-layer-id="{{ layer.data.layer_id }}"
                     data-layer-variable="{{ layer.data.variable }}">
            </div>
          </li>
        </ul>
      </div>
    </li>
    {% endfor %}
  </ul>
{% endfor %}